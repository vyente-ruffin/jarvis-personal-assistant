# M1.2 - Real-time Communication Backend

## Task Description

**What**: Backend server capable of bidirectional real-time communication with the frontend.

**Why**:
- Voice conversation is continuous, not request-response
- Audio must stream in both directions simultaneously
- User needs to interrupt JARVIS mid-sentence (requires real-time channel)

## TDD Requirements

### Test File: `tests/test_websocket.py`

Write these tests FIRST (based on FastAPI TestClient WebSocket API):

```python
from fastapi.testclient import TestClient
from app.main import app

def test_websocket_connection_accepted():
    """WebSocket endpoint accepts connections."""
    client = TestClient(app)
    with client.websocket_connect("/ws/voice") as websocket:
        # Connection should be accepted without error
        assert websocket is not None

def test_websocket_receives_json():
    """WebSocket can receive JSON messages."""
    client = TestClient(app)
    with client.websocket_connect("/ws/voice") as websocket:
        websocket.send_json({"type": "ping"})
        response = websocket.receive_json()
        assert response["type"] == "pong"

def test_websocket_handles_binary_audio():
    """WebSocket can receive binary audio data."""
    client = TestClient(app)
    with client.websocket_connect("/ws/voice") as websocket:
        # Send 16-bit PCM audio chunk (1024 bytes)
        audio_chunk = bytes(1024)
        websocket.send_bytes(audio_chunk)
        response = websocket.receive_json()
        assert response["type"] == "audio_received"

def test_health_endpoint_returns_200():
    """Health endpoint confirms server is running."""
    client = TestClient(app)
    response = client.get("/health")
    assert response.status_code == 200
    assert response.json()["status"] == "healthy"
```

## Verification Command

```bash
pytest tests/test_websocket.py -v
```

## Completion Promise

Only output this when ALL tests pass:

```
<promise>M1.2 COMPLETE</promise>
```

## Dependencies

- M1.1 (Project Structure)

## Files to Create/Modify

- `backend/app/main.py` - FastAPI application with WebSocket endpoint
- `backend/app/routes/websocket.py` - WebSocket handler
- `tests/test_websocket.py`
