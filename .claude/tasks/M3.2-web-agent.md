# M3.2 - Web Browsing Agent

## Task Description

**What**: Autonomous browser that can search, navigate, and extract information.

**Why**:
- "Look this up for me" is a common request
- User can continue conversation while research happens
- Enables complex multi-step information gathering

## TDD Requirements

### Test File: `tests/test_web_agent.py`

Write these tests FIRST (based on Playwright Python docs):

```python
import pytest
from app.agents.web_agent import WebAgent

@pytest.fixture
def web_agent():
    return WebAgent()

@pytest.mark.asyncio
async def test_web_agent_searches_google(web_agent):
    """Web agent can perform Google search."""
    results = await web_agent.search("weather today")

    assert results is not None
    assert len(results) > 0

@pytest.mark.asyncio
async def test_web_agent_navigates_to_url(web_agent):
    """Web agent can navigate to URL."""
    content = await web_agent.navigate("https://example.com")

    assert "Example Domain" in content

@pytest.mark.asyncio
async def test_web_agent_extracts_text(web_agent):
    """Web agent extracts text from page."""
    await web_agent.navigate("https://example.com")
    text = await web_agent.extract_text()

    assert len(text) > 0
    assert "example" in text.lower()

@pytest.mark.asyncio
async def test_web_agent_takes_screenshot(web_agent):
    """Web agent can take screenshots."""
    await web_agent.navigate("https://example.com")
    screenshot = await web_agent.screenshot()

    assert screenshot is not None
    assert len(screenshot) > 0  # PNG bytes

@pytest.mark.asyncio
async def test_web_agent_handles_timeout(web_agent):
    """Web agent handles slow pages gracefully."""
    # Navigate to a slow endpoint
    with pytest.raises(TimeoutError):
        await web_agent.navigate(
            "https://httpstat.us/200?sleep=70000",  # 70 second delay
            timeout=5000  # 5 second timeout
        )

@pytest.mark.asyncio
async def test_web_agent_returns_structured_results(web_agent):
    """Web agent returns structured search results."""
    results = await web_agent.search("python programming")

    # Should have title and URL at minimum
    for result in results[:3]:
        assert "title" in result
        assert "url" in result
```

## Verification Command

```bash
pytest tests/test_web_agent.py -v
```

## Completion Promise

Only output this when ALL tests pass:

```
<promise>M3.2 COMPLETE</promise>
```

## Dependencies

- M3.1 (Vision API) - for streaming integration

## Files to Create/Modify

- `backend/app/agents/web_agent.py` - WebAgent class
- `tests/test_web_agent.py`
